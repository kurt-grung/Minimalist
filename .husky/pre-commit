#!/usr/bin/env sh
echo "ğŸ” Running pre-commit checks..."

# Run tests for CMS package
echo "ğŸ§ª Running CMS package tests..."
if [ -d "cms/node_modules" ]; then
  cd cms && VITEST_THREADS=false npm test || {
    echo "âŒ CMS package tests failed. Please fix the errors before committing."
    exit 1
  }
  cd ..
else
  npm run test:cms || {
    echo "âŒ CMS package tests failed. Please fix the errors before committing."
    exit 1
  }
fi

# Run tests for demo app
echo "ğŸ§ª Running demo app tests..."
if [ -d "demo/node_modules" ]; then
  cd demo && VITEST_THREADS=false npm test || {
    echo "âŒ Demo app tests failed. Please fix the errors before committing."
    exit 1
  }
  cd ..
else
  npm run test:demo || {
    echo "âŒ Demo app tests failed. Please fix the errors before committing."
    exit 1
  }
fi

# Type check demo app (build check will catch TypeScript errors)
echo "ğŸ” TypeScript type check will be performed during build check..."

# Build check (CMS package)
echo "ğŸ”¨ Running CMS package build check..."
if [ -d "cms/node_modules" ]; then
  cd cms && npm run build || {
    echo "âŒ CMS package build failed. Please fix the errors before committing."
    exit 1
  }
  cd ..
else
  npm run build:package || {
    echo "âŒ CMS package build failed. Please fix the errors before committing."
    exit 1
  }
fi

# Build check (Demo app - this will catch TypeScript errors)
echo "ğŸ”¨ Running demo app build check..."
cd demo && npm run build || {
  echo "âŒ Demo app build failed. Please fix the errors before committing."
  exit 1
}
cd ..

echo "âœ… All pre-commit checks passed!"

